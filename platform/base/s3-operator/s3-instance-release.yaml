apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: s3-instance
  namespace: operators
spec:
  releaseName: s3-instance
  dependsOn:
    - name: s3-operator
  chart:
    spec:
      chart: raw
      # renovate: datasource=helm depName=raw registryUrl=https://helm-charts.wikimedia.org/stable
      version: "0.3.0"
      sourceRef:
        kind: HelmRepository
        name: wikimedia
        namespace: flux-system
  interval: 50m
  install:
    createNamespace: true
    remediation:
      retries: 3

  values:
    resources:
      - apiVersion: s3.onyxia.sh/v1alpha1
        kind: S3Instance
        metadata:
          name: default
          namespace: operators
        spec:
          s3Provider: minio
          url: http://${minio_url}
          secretRef: minio-external-secret
          allowedNamespaces: ["*"]
          s3UserDeletionEnabled: true
          pathDeletionEnabled: false
          policyDeletionEnabled: true
          bucketDeletionEnabled: false