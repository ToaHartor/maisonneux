apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: immich-db
  namespace: immich
spec:
  releaseName: immich-db
  chart:
    spec:
      chart: helm/apps/immich-db
      interval: 12h
      sourceRef:
        kind: GitRepository
        name: flux-system
        namespace: flux-system
      reconcileStrategy: Revision
  interval: 50m
  install:
    createNamespace: true
    remediation:
      retries: 3
  values:
    s3:
      # Should be the same as psql-cluster HelmRelease
      secretName: cnpg-${environment}-s3user
      bucketName: cnpg-${environment}
      endpoint: http://${minio_url}
      customDomain: ${minio_url}/cnpg-${environment}

    storage:
      persistentClassName: ${fastdata_storage}-ha
      size: 10Gi
    database:
      postgres:
        clusterName: immich-psql-cluster${psql_suffix:=}
