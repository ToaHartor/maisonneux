s3:
  secretName: authentik-s3user
  bucketName: authentik
  endpoint: "http://localhost:9000"
  customDomain: "localhost:9000/authentik"

ingress:
  domain: auth.example.com
  externalUrl: http://auth.example.com:80

backupLabel:
  homelab/backup-resource: "true"

authentik:
  # List of proxy providers, completed in the HelmRelease
  proxyProviders: []
  # https://github.com/goauthentik/helm/blob/main/charts/authentik/values.yaml
  authentik:
    log_level: debug
    secret_key: TODO # Replaced by fluxcd on installed with the content of authentik-secret-key
    error_reporting:
      enabled: false
    postgresql:
      host: postgres-db-rw.postgres.svc.cluster.local
      name: authentik
      user: authentik
      password: file:///postgres-creds/password
    redis:
      host: dragonfly-cluster.dragonfly.svc.cluster.local

  global:
    addPrometheusAnnotations: true
    
    deploymentStrategy:
      type: RollingUpdate
      rollingUpdate:
        maxUnavailable: 0
        maxSurge: 1

    env: # In release
  server:
    replicas: 1
    pdb:
      enabled: true
      minAvailable: 1
    resources:
      limits:
        cpu: 1000m
        memory: 1Gi
      requests:
        cpu: 100m
        memory: 512Mi
    ingress:
      ingressClassName: traefik
      enabled: false
      hosts:
        - auth.example.com
    volumes:
      - name: postgres-creds
        secret:
          secretName: &authentik-db-secret authentik-db-creds
    volumeMounts:
      - name: postgres-creds
        mountPath: /postgres-creds
        readOnly: true
  worker:
    replicas: 1
    pdb:
      enabled: true
      minAvailable: 1
    resources:
      limits:
        cpu: 1000m
        memory: 1Gi
      requests:
        cpu: 100m
        memory: 512Mi
    volumes:
      - name: postgres-creds
        secret:
          secretName: *authentik-db-secret
    volumeMounts:
      - name: postgres-creds
        mountPath: /postgres-creds
        readOnly: true
  # Disable included postgres and redis
  postgres:
    enabled: false
  redis:
    enabled: false