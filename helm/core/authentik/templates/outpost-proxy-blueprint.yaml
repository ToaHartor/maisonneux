apiVersion: v1
kind: ConfigMap
metadata:
  name: authentik-outpost-proxy-association
  namespace: {{ .Release.Namespace }}
  labels:
    goauthentik_blueprint: "1"
data:
  blueprint.yaml: |
    version: 1
    metadata:
      name: "authentik-outpost-proxy-association"
    
    entries:
      - model: authentik_outposts.outpost
        identifiers: 
          pk: !Find [ authentik_outposts.outpost, [name, authentik Embedded Outpost]] 
        attrs:  
          providers:
            {{- range $provider := .Values.authentik.proxyProviders }}
            - !Find [authentik_providers_proxy.proxyprovider, [name, {{ $provider }}]]
            {{- end }}
          config:
            authentik_host: "{{ .Values.ingress.externalUrl }}"
