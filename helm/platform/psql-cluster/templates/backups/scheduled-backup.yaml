apiVersion: postgresql.cnpg.io/v1
kind: ScheduledBackup
metadata:
  name: psql-cluster-backup
  namespace: {{ .Release.Namespace }}
spec:
  schedule: "0 0 4 * * *"
  backupOwnerReference: self
  immediate: false
  cluster:
    # Temp cluster will not be backed up, which is what we want
    name: psql-cluster
  method: plugin
  pluginConfiguration:
    name: barman-cloud.cloudnative-pg.io
  onlineConfiguration:
    immediateCheckpoint: true
    waitForArchive: true
  suspend: false # true for testing