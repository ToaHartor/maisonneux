---
apiVersion: storage.k8s.io/v1
kind: StorageClass
provisioner: linstor.csi.linbit.com
metadata:
  # HA storage, replicated across the cluster
  name: ${fastdata_storage}-ha
allowVolumeExpansion: true
volumeBindingMode: WaitForFirstConsumer
reclaimPolicy: Retain
parameters:
  csi.storage.k8s.io/fstype: xfs
  # Linstor parameters https://linbit.com/drbd-user-guide/linstor-guide-1_0-en/#s-kubernetes-sc-parameters
  # To apply parameters on an existing cluster, it's possible to delete the StorageClass then let FluxCD reconciliate
  linstor.csi.linbit.com/autoPlace: "2"
  linstor.csi.linbit.com/storagePool: fs-storage
  # 2 per region (the cluster), one per node
  linstor.csi.linbit.com/xReplicasOnDifferent: |
    topology.kubernetes.io/region: 2
    topology.kubernetes.io/zone: 1
---
apiVersion: storage.k8s.io/v1
kind: StorageClass
provisioner: linstor.csi.linbit.com
metadata:
  # Non-HA storage, mainly for pods scheduled to a specific node or for database clusters which already manage the replication
  name: ${fastdata_storage}
allowVolumeExpansion: true
volumeBindingMode: WaitForFirstConsumer
reclaimPolicy: Retain
parameters:
  csi.storage.k8s.io/fstype: xfs
  linstor.csi.linbit.com/autoPlace: "1"
  linstor.csi.linbit.com/storagePool: fs-storage
---
apiVersion: storage.k8s.io/v1
kind: StorageClass
provisioner: linstor.csi.linbit.com
metadata:
  # Ephemeral storage, for jobs and pipeline temporary storage
  name: ${fastdata_storage}-ephemeral
allowVolumeExpansion: true
volumeBindingMode: WaitForFirstConsumer
reclaimPolicy: Delete
parameters:
  csi.storage.k8s.io/fstype: xfs
  linstor.csi.linbit.com/autoPlace: "1"
  linstor.csi.linbit.com/storagePool: fs-storage